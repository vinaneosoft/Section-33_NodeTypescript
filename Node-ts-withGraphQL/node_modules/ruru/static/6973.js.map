{"version":3,"file":"6973.js","mappings":"+JAKA,MAAMA,EAAY,GACX,SAASC,EAAkBC,EAAIC,EAAkBC,GAC9CD,aAA4B,MAC9BA,EAAmB,IAAI,IAAeA,EAAkB,GAAIE,QAAQD,KAExEJ,EAAUM,KAAK,CAACJ,EAAIC,GACxB,CACO,SAASI,IACZ,OAAOP,CACX,C,yMCJIQ,EAAoC,SAAUC,EAAYC,GAC1D,OAAO,SAAUC,EAAQC,GAAOF,EAAUC,EAAQC,EAAKH,EAAa,CACxE,EASO,MAAMI,GAAkC,QAAgB,mCAC/D,IAAIC,GACJ,SAAWA,GACP,MAAMC,EAAU,IAAIC,QACpB,IAAIC,EAAO,EASXH,EAAaI,GARb,SAAYC,GACR,IAAIC,EAAQL,EAAQM,IAAIF,GAKxB,YAJcG,IAAVF,IACAA,IAAUH,EACVF,EAAQQ,IAAIJ,EAAKC,IAEdA,CACX,CAEH,CAZD,CAYGN,IAAiBA,EAAe,CAAC,IACpC,MAAMU,EACF,WAAAC,CAAYC,GACRC,KAAKD,SAAWA,CACpB,CACA,GAAAL,CAAIO,GACA,OAAOD,KAAKD,QAChB,CACA,MAAAG,CAAOD,EAAQE,GACX,OAAOH,KAAKD,QAChB,CACA,UACI,OAAOC,KAAKD,QAChB,EAEJ,MAAMK,EACF,WAAAN,CAAYO,EAAaC,EAAOjC,EAAW0B,EAAUQ,EAAMC,GACvDR,KAAKK,YAAcA,EACnBL,KAAKM,MAAQA,EACbN,KAAK3B,UAAYA,EACjB2B,KAAKD,SAAWA,EAChBC,KAAKO,KAAOA,EACZP,KAAKQ,KAAOA,EACZR,KAAKS,OAAS,IAAI,KAAS,GAAI,GACnC,CACA,IAAAC,CAAKC,GACD,OAAOA,EAAMpC,GAAKyB,KAAK3B,UAAUuC,IAAID,GAAOE,OAAO,CAACC,EAAStB,KAAQ,QAAOL,EAAaI,GAAGC,GAAMsB,GAAU,EAChH,CACA,GAAApB,CAAIiB,GACA,MAAM1B,EAAMe,KAAKU,KAAKC,GAChBI,EAAMf,KAAKS,OAAOf,IAAIT,GAC5B,OAAO8B,GACD,QAAMA,EAAItB,MAAOO,KAAKO,KAAMP,KAAKQ,MACjCR,KAAKgB,SACf,CACA,MAAAd,CAAOS,EAAOlB,GACV,MAAMR,EAAMe,KAAKU,KAAKC,GACtB,IAAII,EAAMf,KAAKS,OAAOf,IAAIT,GACrB8B,IACDA,EAAM,IAAI,KAAqB,GAC/Bf,KAAKS,OAAOb,IAAIX,EAAK8B,IAEzB,MAAME,GAAW,QAAMF,EAAIb,OAAOT,GAAQO,KAAKO,KAAMP,KAAKQ,MAI1D,OAHK,QAAcG,EAAMO,IAAK,WAC1BlB,KAAKK,YAAYc,MAAM,cAAcnB,KAAKM,cAAcK,EAAMO,IAAIE,iBAAiBH,OAEhFA,CACX,CACA,QAAAI,GACI,MAAMC,EAAS,IAAI,KACnB,IAAK,MAAO,CAAEP,KAAQf,KAAKS,OACvBa,EAAOpB,OAAOa,EAAItB,OAEtB,OAAO6B,EAAO7B,KAClB,CACA,UACI,MAAMA,EAA2B,EAAlBO,KAAKqB,YAAmBrB,KAAKD,SAC5C,OAAO,QAAMN,EAAOO,KAAKO,KAAMP,KAAKQ,KACxC,EAEJ,IAAIe,EAAiC,MACjC,WAAAzB,CAAYO,EAAamB,GACrBxB,KAAKK,YAAcA,EACnBL,KAAKyB,MAAQ,IAAIC,IACjB1B,KAAK2B,OAASH,EAAWI,yBAA2BJ,EAAWK,OACnE,CACA,IAAIC,EAASC,EAAMC,GACf,MAAMC,EAAMD,GAAQC,KAAO,GACrBC,EAAMF,GAAQE,KAAOD,GAAO,EAC5BE,EAAQH,GAAQ/C,UAAOU,EACvBV,EAAM,GAAGE,EAAaI,GAAGuC,MAAYG,IAAME,EAAQ,IAAMA,EAAQ,KACvE,IAAIC,EAAOpC,KAAKyB,MAAM/B,IAAIT,GAY1B,OAXKmD,IACGpC,KAAK2B,QACL3B,KAAKK,YAAYgC,MAAM,cAAcN,oCACrCK,EAAO,IAAIvC,EAA8B,IAANoC,IAGnCG,EAAO,IAAIhC,EAA2BJ,KAAKK,YAAa0B,EAAMD,EAAmC,EAAzB9B,KAAKsC,mBAAiC,IAANL,EACxGA,EAAKC,GAETlC,KAAKyB,MAAM7B,IAAIX,EAAKmD,IAEjBA,CACX,CACA,eAAAE,GAEI,MAAMhB,EAAS,IAAI,KACnB,IAAK,MAAMc,KAAQpC,KAAKyB,MAAMc,SAC1BjB,EAAOpB,OAAOkC,EAAKpB,WAEvB,OAAOM,EAAO7B,KAClB,GAEJ8B,EA7H8C,SAAUiB,EAAYxD,EAAQC,EAAKwD,GAC7E,IAA2HC,EAAvHC,EAAIC,UAAUC,OAAQC,EAAIH,EAAI,EAAI3D,EAAkB,OAATyD,EAAgBA,EAAOM,OAAOC,yBAAyBhE,EAAQC,GAAOwD,EACrH,GAAuB,iBAAZQ,SAAoD,mBAArBA,QAAQC,SAAyBJ,EAAIG,QAAQC,SAASV,EAAYxD,EAAQC,EAAKwD,QACpH,IAAK,IAAIU,EAAIX,EAAWK,OAAS,EAAGM,GAAK,EAAGA,KAAST,EAAIF,EAAWW,MAAIL,GAAKH,EAAI,EAAID,EAAEI,GAAKH,EAAI,EAAID,EAAE1D,EAAQC,EAAK6D,GAAKJ,EAAE1D,EAAQC,KAAS6D,GAChJ,OAAOH,EAAI,GAAKG,GAAKC,OAAOK,eAAepE,EAAQC,EAAK6D,GAAIA,CAChE,CAwHiCO,CAAW,CACxCxE,EAAQ,EAAG,MACXA,EAAQ,EAAG,MACZ0C,IAEH,OAAkBrC,EAAiCqC,EAAgC,E,kBCjI5E,IAAI+B,E,oCACX,SAAWA,GACPA,EAAMC,WAAa,IAAI7B,IACvB4B,EAAME,UAAY,aAClBF,EAAMG,gBAAkB,mBAIxBH,EAAMI,uBAHN,SAAgCC,GAC5B,OAAOA,EAAKL,EAAMG,kBAAoB,EAC1C,CAEH,CARD,CAQGH,IAAUA,EAAQ,CAAC,IACf,MAAMM,EAAwBC,EAAgB,wBAa9C,SAASA,EAAgBC,GAC5B,GAAIR,EAAMC,WAAWQ,IAAID,GACrB,OAAOR,EAAMC,WAAW7D,IAAIoE,GAEhC,MAAMvF,EAAK,SAAUS,EAAQC,EAAK+E,GAC9B,GAAyB,IAArBpB,UAAUC,OACV,MAAM,IAAIoB,MAAM,qEAlB5B,SAAgC1F,EAAIS,EAAQgF,GACpChF,EAAOsE,EAAME,aAAexE,EAC5BA,EAAOsE,EAAMG,iBAAiB9E,KAAK,CAAEJ,KAAIyF,WAGzChF,EAAOsE,EAAMG,iBAAmB,CAAC,CAAElF,KAAIyF,UACvChF,EAAOsE,EAAME,WAAaxE,EAElC,CAYQkF,CAAuB3F,EAAIS,EAAQgF,EACvC,EAGA,OAFAzF,EAAG6C,SAAW,IAAM0C,EACpBR,EAAMC,WAAW3D,IAAIkE,EAAWvF,GACzBA,CACX,C,mCCxCO,MAAM4F,GAAsB,E,SAAA,IAAgB,qB,kBCG5C,SAASC,EAAM3E,EAAOwC,EAAKC,GAC9B,OAAOmC,KAAKpC,IAAIoC,KAAKnC,IAAIzC,EAAOwC,GAAMC,EAC1C,C,oCACO,MAAMoC,EACT,WAAAxE,GACIE,KAAKuE,GAAK,EACVvE,KAAKwE,KAAO,CAChB,CACA,MAAAtE,CAAOT,GAGH,OAFAO,KAAKwE,KAAOxE,KAAKwE,MAAQ/E,EAAQO,KAAKwE,MAAQxE,KAAKuE,GACnDvE,KAAKuE,IAAM,EACJvE,KAAKwE,IAChB,CACA,SAAI/E,GACA,OAAOO,KAAKwE,IAChB,EAEG,MAAMC,EACT,WAAA3E,CAAY4E,GACR1E,KAAKuE,GAAK,EACVvE,KAAKwE,KAAO,EACZxE,KAAK2E,QAAU,GACf3E,KAAK4E,OAAS,EACd5E,KAAK6E,KAAO,EACZ7E,KAAK2E,QAAU,IAAIG,MAAMJ,GACzB1E,KAAK2E,QAAQI,KAAK,EAAG,EAAGL,EAC5B,CACA,MAAAxE,CAAOT,GACH,MAAMuF,EAAWhF,KAAK2E,QAAQ3E,KAAK4E,QASnC,OARA5E,KAAK2E,QAAQ3E,KAAK4E,QAAUnF,EAC5BO,KAAK4E,QAAU5E,KAAK4E,OAAS,GAAK5E,KAAK2E,QAAQ9B,OAC/C7C,KAAK6E,MAAQG,EACbhF,KAAK6E,MAAQpF,EACTO,KAAKuE,GAAKvE,KAAK2E,QAAQ9B,SACvB7C,KAAKuE,IAAM,GAEfvE,KAAKwE,KAAOxE,KAAK6E,KAAO7E,KAAKuE,GACtBvE,KAAKwE,IAChB,CACA,SAAI/E,GACA,OAAOO,KAAKwE,IAChB,E,mCCzCG,MAAMS,EACT,WAAAnF,CAAY6D,EAAMuB,EAAkB,GAAIzG,GAA+B,GACnEuB,KAAK2D,KAAOA,EACZ3D,KAAKkF,gBAAkBA,EACvBlF,KAAKvB,6BAA+BA,CACxC,E","sources":["webpack://ruru/../../node_modules/monaco-editor/esm/vs/platform/instantiation/common/extensions.js","webpack://ruru/../../node_modules/monaco-editor/esm/vs/editor/common/services/languageFeatureDebounce.js","webpack://ruru/../../node_modules/monaco-editor/esm/vs/platform/instantiation/common/instantiation.js","webpack://ruru/../../node_modules/monaco-editor/esm/vs/platform/environment/common/environment.js","webpack://ruru/../../node_modules/monaco-editor/esm/vs/base/common/numbers.js","webpack://ruru/../../node_modules/monaco-editor/esm/vs/platform/instantiation/common/descriptors.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { SyncDescriptor } from './descriptors.js';\nconst _registry = [];\nexport function registerSingleton(id, ctorOrDescriptor, supportsDelayedInstantiation) {\n    if (!(ctorOrDescriptor instanceof SyncDescriptor)) {\n        ctorOrDescriptor = new SyncDescriptor(ctorOrDescriptor, [], Boolean(supportsDelayedInstantiation));\n    }\n    _registry.push([id, ctorOrDescriptor]);\n}\nexport function getSingletonServiceDescriptors() {\n    return _registry;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nimport { doHash } from '../../../base/common/hash.js';\nimport { LRUCache } from '../../../base/common/map.js';\nimport { clamp, MovingAverage, SlidingWindowAverage } from '../../../base/common/numbers.js';\nimport { IEnvironmentService } from '../../../platform/environment/common/environment.js';\nimport { registerSingleton } from '../../../platform/instantiation/common/extensions.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { matchesScheme } from '../../../base/common/network.js';\nexport const ILanguageFeatureDebounceService = createDecorator('ILanguageFeatureDebounceService');\nvar IdentityHash;\n(function (IdentityHash) {\n    const _hashes = new WeakMap();\n    let pool = 0;\n    function of(obj) {\n        let value = _hashes.get(obj);\n        if (value === undefined) {\n            value = ++pool;\n            _hashes.set(obj, value);\n        }\n        return value;\n    }\n    IdentityHash.of = of;\n})(IdentityHash || (IdentityHash = {}));\nclass NullDebounceInformation {\n    constructor(_default) {\n        this._default = _default;\n    }\n    get(_model) {\n        return this._default;\n    }\n    update(_model, _value) {\n        return this._default;\n    }\n    default() {\n        return this._default;\n    }\n}\nclass FeatureDebounceInformation {\n    constructor(_logService, _name, _registry, _default, _min, _max) {\n        this._logService = _logService;\n        this._name = _name;\n        this._registry = _registry;\n        this._default = _default;\n        this._min = _min;\n        this._max = _max;\n        this._cache = new LRUCache(50, 0.7);\n    }\n    _key(model) {\n        return model.id + this._registry.all(model).reduce((hashVal, obj) => doHash(IdentityHash.of(obj), hashVal), 0);\n    }\n    get(model) {\n        const key = this._key(model);\n        const avg = this._cache.get(key);\n        return avg\n            ? clamp(avg.value, this._min, this._max)\n            : this.default();\n    }\n    update(model, value) {\n        const key = this._key(model);\n        let avg = this._cache.get(key);\n        if (!avg) {\n            avg = new SlidingWindowAverage(6);\n            this._cache.set(key, avg);\n        }\n        const newValue = clamp(avg.update(value), this._min, this._max);\n        if (!matchesScheme(model.uri, 'output')) {\n            this._logService.trace(`[DEBOUNCE: ${this._name}] for ${model.uri.toString()} is ${newValue}ms`);\n        }\n        return newValue;\n    }\n    _overall() {\n        const result = new MovingAverage();\n        for (const [, avg] of this._cache) {\n            result.update(avg.value);\n        }\n        return result.value;\n    }\n    default() {\n        const value = (this._overall() | 0) || this._default;\n        return clamp(value, this._min, this._max);\n    }\n}\nlet LanguageFeatureDebounceService = class LanguageFeatureDebounceService {\n    constructor(_logService, envService) {\n        this._logService = _logService;\n        this._data = new Map();\n        this._isDev = envService.isExtensionDevelopment || !envService.isBuilt;\n    }\n    for(feature, name, config) {\n        const min = config?.min ?? 50;\n        const max = config?.max ?? min ** 2;\n        const extra = config?.key ?? undefined;\n        const key = `${IdentityHash.of(feature)},${min}${extra ? ',' + extra : ''}`;\n        let info = this._data.get(key);\n        if (!info) {\n            if (this._isDev) {\n                this._logService.debug(`[DEBOUNCE: ${name}] is disabled in developed mode`);\n                info = new NullDebounceInformation(min * 1.5);\n            }\n            else {\n                info = new FeatureDebounceInformation(this._logService, name, feature, (this._overallAverage() | 0) || (min * 1.5), // default is overall default or derived from min-value\n                min, max);\n            }\n            this._data.set(key, info);\n        }\n        return info;\n    }\n    _overallAverage() {\n        // Average of all language features. Not a great value but an approximation\n        const result = new MovingAverage();\n        for (const info of this._data.values()) {\n            result.update(info.default());\n        }\n        return result.value;\n    }\n};\nLanguageFeatureDebounceService = __decorate([\n    __param(0, ILogService),\n    __param(1, IEnvironmentService)\n], LanguageFeatureDebounceService);\nexport { LanguageFeatureDebounceService };\nregisterSingleton(ILanguageFeatureDebounceService, LanguageFeatureDebounceService, 1 /* InstantiationType.Delayed */);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n// ------ internal util\nexport var _util;\n(function (_util) {\n    _util.serviceIds = new Map();\n    _util.DI_TARGET = '$di$target';\n    _util.DI_DEPENDENCIES = '$di$dependencies';\n    function getServiceDependencies(ctor) {\n        return ctor[_util.DI_DEPENDENCIES] || [];\n    }\n    _util.getServiceDependencies = getServiceDependencies;\n})(_util || (_util = {}));\nexport const IInstantiationService = createDecorator('instantiationService');\nfunction storeServiceDependency(id, target, index) {\n    if (target[_util.DI_TARGET] === target) {\n        target[_util.DI_DEPENDENCIES].push({ id, index });\n    }\n    else {\n        target[_util.DI_DEPENDENCIES] = [{ id, index }];\n        target[_util.DI_TARGET] = target;\n    }\n}\n/**\n * The *only* valid way to create a {{ServiceIdentifier}}.\n */\nexport function createDecorator(serviceId) {\n    if (_util.serviceIds.has(serviceId)) {\n        return _util.serviceIds.get(serviceId);\n    }\n    const id = function (target, key, index) {\n        if (arguments.length !== 3) {\n            throw new Error('@IServiceName-decorator can only be used to decorate a parameter');\n        }\n        storeServiceDependency(id, target, index);\n    };\n    id.toString = () => serviceId;\n    _util.serviceIds.set(serviceId, id);\n    return id;\n}\n","import { createDecorator } from '../../instantiation/common/instantiation.js';\nexport const IEnvironmentService = createDecorator('environmentService');\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nexport function clamp(value, min, max) {\n    return Math.min(Math.max(value, min), max);\n}\nexport class MovingAverage {\n    constructor() {\n        this._n = 1;\n        this._val = 0;\n    }\n    update(value) {\n        this._val = this._val + (value - this._val) / this._n;\n        this._n += 1;\n        return this._val;\n    }\n    get value() {\n        return this._val;\n    }\n}\nexport class SlidingWindowAverage {\n    constructor(size) {\n        this._n = 0;\n        this._val = 0;\n        this._values = [];\n        this._index = 0;\n        this._sum = 0;\n        this._values = new Array(size);\n        this._values.fill(0, 0, size);\n    }\n    update(value) {\n        const oldValue = this._values[this._index];\n        this._values[this._index] = value;\n        this._index = (this._index + 1) % this._values.length;\n        this._sum -= oldValue;\n        this._sum += value;\n        if (this._n < this._values.length) {\n            this._n += 1;\n        }\n        this._val = this._sum / this._n;\n        return this._val;\n    }\n    get value() {\n        return this._val;\n    }\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nexport class SyncDescriptor {\n    constructor(ctor, staticArguments = [], supportsDelayedInstantiation = false) {\n        this.ctor = ctor;\n        this.staticArguments = staticArguments;\n        this.supportsDelayedInstantiation = supportsDelayedInstantiation;\n    }\n}\n"],"names":["_registry","registerSingleton","id","ctorOrDescriptor","supportsDelayedInstantiation","Boolean","push","getSingletonServiceDescriptors","__param","paramIndex","decorator","target","key","ILanguageFeatureDebounceService","IdentityHash","_hashes","WeakMap","pool","of","obj","value","get","undefined","set","NullDebounceInformation","constructor","_default","this","_model","update","_value","FeatureDebounceInformation","_logService","_name","_min","_max","_cache","_key","model","all","reduce","hashVal","avg","default","newValue","uri","trace","toString","_overall","result","LanguageFeatureDebounceService","envService","_data","Map","_isDev","isExtensionDevelopment","isBuilt","feature","name","config","min","max","extra","info","debug","_overallAverage","values","decorators","desc","d","c","arguments","length","r","Object","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__decorate","_util","serviceIds","DI_TARGET","DI_DEPENDENCIES","getServiceDependencies","ctor","IInstantiationService","createDecorator","serviceId","has","index","Error","storeServiceDependency","IEnvironmentService","clamp","Math","MovingAverage","_n","_val","SlidingWindowAverage","size","_values","_index","_sum","Array","fill","oldValue","SyncDescriptor","staticArguments"],"sourceRoot":""}